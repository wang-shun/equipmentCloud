webpackJsonp([23],{"2hbF":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.el-table__empty-block{\r\n  min-height: 0;\n}\n.app-container {\r\n    font-family: Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, SimSun, sans-serif;\r\n    overflow: auto;\r\n    font-weight: 400;\r\n    -webkit-font-smoothing: antialiased;\n}\n.tb-edit .el-input {\r\n    display: none\n}\n.tb-edit .current-row .el-input {\r\n    display: block;\n}\n.el-input--small .el-input__inner {\r\n  height: 22px;\r\n  line-height: 22px;\n}\n.tb-edit .current-row .el-input+span {\r\n    display: none\n}\r\n",""])},J2Dp:function(t,e,a){var s=a("2hbF");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a("rjj0")("57dc261e",s,!0)},"Ml/Y":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("lDdF"),n=a.n(s),i=a("uXZL"),r=a.n(i),l=a("ZjsX"),o=a("7t+N"),u=a.n(o),c=sessionStorage.getItem("token"),m=sessionStorage.getItem("name"),d=sessionStorage.getItem("id"),h=JSON.parse(sessionStorage.getItem("dwList")),f=h.reduce(function(t,e){return t[e.code]=e.name,t},{}),p={name:"listofcollectfees",data:function(){return{tableHeight:document.body.clientHeight-320,positionList:h,listQuery:{date:"",isdw:"",isdwname:"",datename:""},name:m,id:d,sumSums:0,summarythree:0,summarytable:[]}},mounted:function(){this.sfoutdate()},methods:{sfoutdate:function(){var t=(new Date).getDate();t>=21&&t<=31?u()("#resetjs").show():u()("#resetjs").hide()},recalculate:function(){var t=this;t.summarytable=[];var e={positionCode:t.listQuery.isdw,exportAtStr:t.listQuery.date};Object(l.d)("/v1/elFeeMiddleT/refresh",{token:c,authorityCode:1},e,function(e){if(200===e.data.status){var a=e.data.data;if(a){for(var s={},n=0;n<a.length;n++)"0000"===a[n].middleCode&&(s=a[n],a.splice(n,1));a.unshift(s),t.summarytable=a,t.changeSun(),t.sumSum(),t.sumSumhj()}else t.$notify({title:"系统提示",message:e.data.msg,type:"warning",duration:2e3})}else t.$notify({title:"系统提示",message:e.data.msg,type:"warning",duration:2e3})},function(e){console.log(e),t.$notify({title:"系统提示",message:"系统错误",type:"warning",duration:2e3})})},exportExcel:function(){for(var t=this,e=0;e<t.summarytable.length;e++)t.summarytable[e].costA2=parseFloat(t.summarytable[e].costA2);for(var a=0;a<t.summarytable.length;a++)t.summarytable[a].createBy=parseFloat(t.id);var s=t.summarytable;0===t.summarytable.length?t.$notify({title:"系统提示",message:"导出报表不能为空",type:"warning",duration:2e3}):Object(l.f)("/v1/elFeeMiddleT",{token:c,authorityCode:1},s,function(e){if(200===e.data.status){var a=r.a.utils.table_to_book(document.querySelector("#reportDiv")),s=r.a.write(a,{bookType:"xlsx",bookSST:!0,type:"array"});try{n.a.saveAs(new Blob([s],{type:"application/octet-stream"}),"矿处通用机电租赁费用汇总表.xlsx")}catch(t){"undefined"!=typeof console&&console.log(t,s)}return t.$notify({title:"系统提示",message:"报表导出成功",type:"success",duration:2e3}),s}t.$notify({title:"系统提示",message:e.data.msg,type:"warning",duration:2e3})},function(e){console.log(e),t.$notify({title:"系统提示",message:"报表导出失败",type:"warning",duration:2e3})})},changeSun:function(){for(var t=/^(.*\..{3}).*$/,e=0;e<this.summarytable.length;e++){var a=this.add(this.summarytable[e].costA1,this.summarytable[e].costA2,this.summarytable[e].costA3);this.summarytable[e].totalFee=Number(String(a).replace(t,"$1"))}},sumSum:function(){this.summarythree=0;for(var t=1;t<this.summarytable.length;t++)this.summarythree+=parseFloat(this.summarytable[t].costA2);this.summarythree=Number(String(this.summarythree).replace(/^(.*\..{3}).*$/,"$1")),console.log(this.summarythree)},sumSumhj:function(){this.sumSums=0;for(var t=1;t<this.summarytable.length;t++)this.sumSums+=parseFloat(this.summarytable[t].totalFee);this.sumSums=Number(String(this.sumSums).replace(/^(.*\..{3}).*$/,"$1"))},add:function(){var t=arguments,e=0,a=0;for(var s in t){var n=""+t[s];if(-1!==n.indexOf(".")){var i=n.split(".")[1].length;e=e<i?i:e}}var r=Math.pow(10,e);for(var l in t)a+=t[l]*r;return a/r},search:function(){var t=this;t.summarytable=[],Object(l.d)("/v1/elFeeMiddleT",{token:c,authorityCode:1},{positionCode:t.listQuery.isdw,exportAtStr:t.listQuery.date},function(e){if(console.log(e),200===e.data.status){var a=e.data.data;if(a){for(var s={},n=0;n<a.length;n++)"0000"===a[n].middleCode&&(s=a[n],a.splice(n,1));a.unshift(s),t.summarytable=a,t.changeSun(),t.sumSum(),t.sumSumhj()}else t.$notify({title:"系统提示",message:e.data.msg,type:"warning",duration:2e3})}else t.$notify({title:"系统提示",message:e.data.msg,type:"warning",duration:2e3})},function(e){console.log(e),t.$notify({title:"系统提示",message:"报表查询失败",type:"warning",duration:2e3})})},reset:function(){this.listQuery.date="",this.listQuery.isdw="",this.listQuery.isdwname="",this.summarytable=[]},handleEdit:function(t,e){console.log(t,e),this.changeSun(),this.sumSum(),this.sumSumhj()},handleCurrentChange:function(t,e,a){},getSummaries:function(t){var e=t.columns,a=t.data,s=[];return e.forEach(function(t,e){if(0!==e){var n=a.map(function(e){return Number(e[t.property])});n.every(function(t){return isNaN(t)})||(s[e]=n.reduce(function(t,e){var a=Number(e);return isNaN(a)?t:t+e},0))}else s[e]="合计"}),s}},filters:{stateFilter:function(t){return f[t]}},watch:{"listQuery.isdw":function(t,e){this.listQuery.isdwname=f[this.listQuery.isdw],void 0===this.listQuery.isdwname&&(this.listQuery.isdwname="")},"listQuery.date":function(t,e){this.listQuery.date?(this.listQuery.datename=this.listQuery.date,this.listQuery.datename=this.listQuery.datename.replace("-","年")+"月"):this.listQuery.datename=""}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-date-picker",{staticClass:"filter-item",staticStyle:{width:"140px"},attrs:{type:"month",placeholder:"选择年月","value-format":"yyyy-MM",format:"yyyy-MM"},model:{value:t.listQuery.date,callback:function(e){t.$set(t.listQuery,"date",e)},expression:"listQuery.date"}}),t._v(" "),a("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"选择矿处单位"},model:{value:t.listQuery.isdw,callback:function(e){t.$set(t.listQuery,"isdw",e)},expression:"listQuery.isdw"}},t._l(t.positionList,function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})})),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"small",icon:"el-icon-edit",id:"resetjs"},on:{click:t.recalculate}},[t._v("重新计算")]),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.reset}},[t._v("重置")]),t._v(" "),a("div",{staticClass:"btn_right",staticStyle:{float:"right"}},[a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"warning",icon:"el-icon-upload"},on:{click:t.exportExcel}},[t._v("导出")])],1)],1),t._v(" "),a("div",{attrs:{id:"reportDiv"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"矿处通用机电租赁费用汇总表"}},[a("el-table-column",{attrs:{align:"left",label:"矿处单位："+this.listQuery.isdwname}}),t._v(" "),a("el-table-column",{attrs:{align:"right",label:t.listQuery.datename}})],1)],1),t._v(" "),a("el-table",{ref:"moviesTable",staticClass:"tb-edit",staticStyle:{width:"100%","max-height":"740px"},attrs:{data:t.summarytable,border:"",fit:"","highlight-current-row":"",height:t.tableHeight},on:{"row-click":t.handleCurrentChange}},[a("el-table-column",{attrs:{align:"center",width:"150px",label:"设备名称（中类）"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.middleName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"在籍数量",prop:"enrollmentnum",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.equipmentNum))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"在用数量",prop:"usenum",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.useNum))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"租赁费",prop:"rent",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.costA1))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"费用调整",prop:"costadjustment",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.costA3))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",width:"150px",label:"非正常损坏赔偿费",prop:"damages"},scopedSlots:t._u([{key:"default",fn:function(e){return["合计"!==e.row.middleName?a("el-input",{attrs:{size:"small",placeholder:"请输入内容"},on:{change:function(a){t.handleEdit(e.$index,e.row)}},model:{value:e.row.costA2,callback:function(a){t.$set(e.row,"costA2",a)},expression:"scope.row.costA2"}}):t._e(),t._v(" "),"合计"!==e.row.middleName?a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.costA2))]):a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.costA2=t.summarythree))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"合计",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return["合计"!==e.row.middleName?a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.totalFee))]):a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.totalFee=t.sumSums))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"备注",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"small",placeholder:"请输入内容"},model:{value:e.row.remarks,callback:function(a){t.$set(e.row,"remarks",a)},expression:"scope.row.remarks"}}),t._v(" "),a("span",{attrs:{align:"center"}},[t._v(t._s(e.row.remarks))])]}}])})],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"left",label:"制表："+this.name}}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"审核:"}}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"矿方确认签字:"}})],1)],1)])},staticRenderFns:[]};var g=a("VU/8")(p,y,!1,function(t){a("J2Dp")},null,null);e.default=g.exports}});