webpackJsonp([75],{Kr7T:function(t,e,i){var a=i("okNR");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("a41b7a00",a,!0)},okNR:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.btn_right{\n  float: right;\n}\n.block {\n  margin-top: 15px;\n}\n",""])},sQXh:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("vLgD");var n=i("cAgV"),s=i("0xDb"),o=i("ZjsX"),l=sessionStorage.getItem("token"),r={name:"complexTable",directives:{waves:n.a},data:function(){return{hasshow:!0,currentPage:1,pageSize:15,isUpdate:!0,setDisabled:!1,tableKey:0,list:null,total:null,listLoading:!0,companyDatas:[{id:"",name:"",pcode:"",remark:""}],statusOptions:[],temp:{name:"",pcode:"",remark:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑公司",create:"新添公司",info:"公司详细"},dialogPvVisible:!1,pvData:[],rules:{name:[{required:!0,message:"请输入公司名称",trigger:"change"}],pId:[{required:!0,message:"请选择上级公司",trigger:"change"}]},downloadLoading:!1}},mounted:function(){},filters:{},created:function(){this.getList(this.currentPage,this.pageSize),this.getCompanyList()},methods:{getList:function(t,e){var i=this;this.listLoading=!0,this.listLoading=!0;var a=this,n={page:t,size:e,jsonString:{typeId:1}};Object(o.d)("/v1/orgs",{token:l,authorityCode:1},n,function(t){200===t.data.status?(a.total=t.data.data.total,a.companyDatas=t.data.data.list):(a.$notify({title:"错误",message:t.data.msg,type:"error",duration:2e3}),a.hasshow=!1)},function(t){this.$notify({title:"错误",message:t,type:"error",duration:2e3})}),setTimeout(function(){i.listLoading=!1},1500)},selectRow:function(t){this.selectlistRow=t},handleFilter:function(){this.getList(this.currentPage,this.pageSize)},handleSizeChange:function(t){this.getList(this.currentPage,t)},handleCurrentChange:function(t){this.getList(t,this.pageSize)},handleCreate:function(){var t=this;this.isUpdate=!0,this.setDisabled=!1,this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()}),setTimeout(function(){t.$refs.dataForm.resetFields(),t.temp.remark="",t.temp.pId=""},300)},handleUpdate:function(t){var e=this;this.isUpdate=!0,this.setDisabled=!1,this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},edit:function(){this.selectlistRow&&0!==this.selectlistRow.length&&1===this.selectlistRow.length?(this.handleUpdate(),this.getCompanyDetail(this.selectlistRow[0].id)):this.$notify({title:"系统提示",message:"请选择一条数据进行编辑！",type:"warning",duration:2e3})},handleInfo:function(t){var e=this;this.isUpdate=!1,this.setDisabled=!0,this.dialogStatus="info",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()}),this.getCompanyDetail(t.id)},getCompanyDetail:function(t){this.dialogFormVisible=!0;var e=this;Object(o.d)("/v1/orgs/"+t,{token:l,authorityCode:1},{},function(t){e.temp=t.data.data})},getCompanyList:function(t){var e=this;Object(o.d)("/v1/orgs/findList",{token:l,authorityCode:1},{},function(t){e.statusOptions=t.data.data})},addCompany:function(){var t=this;this.$refs.dataForm.validate(function(e){e&&Object(o.f)("/v1/orgs/",{token:l,authorityCode:1},{name:t.temp.name,pId:t.temp.pId},function(e){t.dialogFormVisible=!1,t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3}),t.getList(t.currentPage,t.pageSize)})})},updateCompany:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){var i={id:t.selectlistRow[0].id,name:t.temp.name,pId:t.selectlistRow[0].pId};Object(o.g)("/v1/orgs",{token:l,authorityCode:1},i,function(e){200===e.data.status?(t.dialogFormVisible=!1,t.getList(t.currentPage,t.pageSize),t.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})):t.$notify({title:"成功",message:"更新失败",type:"warning",duration:2e3})},function(e){console.log(e),t.$notify({title:"系统提示",message:"请求错误",type:"error",duration:2e3})})}})},handleDelete:function(t){this.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3});var e=this.companyDatas.indexOf(t);this.companyDatas.splice(e,1)},handleFetchPv:function(t){var e=this;(function(t){return Object(a.a)({url:"/article/pv",method:"get",params:{pv:t}})})(t).then(function(t){e.pvData=t.data.pvData,e.dialogPvVisible=!0})},handleDownload:function(){var t=this;this.downloadLoading=!0,Promise.all([i.e(0),i.e(101)]).then(i.bind(null,"zWO4")).then(function(e){var i=t.formatJson(["timestamp","title","type","importance","status"],t.list);e.export_json_to_excel({header:["timestamp","title","type","importance","status"],data:i,filename:"table-list"}),t.downloadLoading=!1})},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){return"timestamp"===t?Object(s.c)(e[t]):e[t]})})},delData:function(){var t=this,e=this;if(this.selectlistRow)if(0!==this.selectlistRow.length&&1===this.selectlistRow.length)for(var i=this.selectlistRow.length,a=0;a<i;a++)this.$confirm("确认要删除么?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.selectlistRow.forEach(function(i,a){t.companyDatas.forEach(function(t,a){i.id===t.id&&Object(o.c)("/v1/orgs/"+t.id,{token:l,authorityCode:1},{},function(t){this.$notify({title:"成功",message:"删除成功",type:"success",duration:3e3}),e.getList(e.currentPage,e.pageSize)},function(t){e.$notify({title:"错误",message:t,type:"error",duration:3e3})})})})}).catch(function(){t.$notify({title:"系统提示",message:"取消删除",type:"info",duration:3e3})});else this.$notify({title:"系统提示",message:"请选择一条数据进行删除！",type:"warning",duration:3e3});else this.$notify({title:"系统提示",message:"请选择一条数据进行删除！",type:"warning",duration:3e3})}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("div",{staticClass:"btn_right"},[i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:t.handleCreate}},[t._v("添加")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:function(e){t.edit()}}},[t._v("编辑")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(e){e.preventDefault(),t.delData()}}},[t._v("删除")])],1)]),t._v(" "),t.hasshow?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,ref:"moviesTable",staticStyle:{width:"100%"},attrs:{data:t.companyDatas,border:"",fit:"","highlight-current-row":"",height:"705px"},on:{"selection-change":t.selectRow}},[i("el-table-column",{attrs:{type:"selection",width:"35"}}),t._v(" "),i("el-table-column",{attrs:{width:"150px",align:"center",label:"上级公司"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.pId))])]}}])}),t._v(" "),i("el-table-column",{attrs:{width:"190px",align:"center",label:"公司名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"link-type",on:{click:function(i){t.handleInfo(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),t._v(" "),i("el-table-column",{attrs:{width:"300px",align:"center",label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.remark))])]}}])})],1):i("div",[i("p",{staticStyle:{width:"100%","text-align":"center","line-height":"50px",color:"gray"}},[t._v("您无权限查看")])]),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"480px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"dataForm",staticStyle:{"margin-left":"15px"},attrs:{rules:t.rules,model:t.temp,"label-position":"right","label-width":"120px",disabled:t.setDisabled}},[i("el-form-item",{attrs:{label:"公司名称",required:"",prop:"name"}},[i("el-input",{staticStyle:{width:"250px"},model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name",e)},expression:"temp.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"上级公司",required:"",prop:"pId"}},[i("el-select",{staticClass:"filter-item",staticStyle:{width:"250px"},on:{change:function(e){t.getCompanyList(e)}},model:{value:t.temp.pId,callback:function(e){t.$set(t.temp,"pId",e)},expression:"temp.pId"}},t._l(t.statusOptions,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{staticStyle:{width:"250px"},attrs:{type:"textarea"},model:{value:t.temp.remark,callback:function(e){t.$set(t.temp,"remark",e)},expression:"temp.remark"}})],1)],1),t._v(" "),t.isUpdate?i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?i("el-button",{attrs:{type:"primary"},on:{click:t.addCompany}},[t._v("确定")]):i("el-button",{attrs:{type:"primary"},on:{click:t.updateCompany}},[t._v("确定")])],1):t._e()],1),t._v(" "),i("div",{staticClass:"block"},[i("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[15,30,45,60,75,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var d=i("VU/8")(r,c,!1,function(t){i("Kr7T")},null,null);e.default=d.exports}});